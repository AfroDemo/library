import{r as _,j as e,$ as D,m as O}from"./app-B3QjrgfE.js";import{A as S,T as g,U as T}from"./app-layout-DBHVPZfr.js";import{D as C}from"./download-peLvOtVv.js";import{c as v}from"./createLucideIcon-Z2OSLAlR.js";import{B as j}from"./chevron-right-bRrSZfP4.js";import{C as b}from"./clock-Pf-G8D3_.js";import{C as A}from"./calendar-BhZAk7jL.js";import"./app-logo-icon-BOS49W9v.js";import"./index-CMzxVQNP.js";import"./index--B1BczC_.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],p=v("Mail",R);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],L=v("Phone",$),B=[{title:"Dashboard",href:"/dashboard"},{title:"Overdue Books",href:"/librarian/overdue"}];function J(N){const{overdueTransactions:r}=N,[l,i]=_.useState([]),h=s=>new Date(s).toLocaleDateString(),o=s=>{const t=new Date(s),c=new Date().getTime()-t.getTime(),n=Math.ceil(c/(1e3*60*60*24));return n>0?n:0},m=s=>(s*.5).toFixed(2),f=s=>{i(t=>t.includes(s)?t.filter(d=>d!==s):[...t,s])},y=()=>{l.length===r.length?i([]):i(r.map(s=>s.id))},u=s=>{const t=s||l;if(t.length===0){alert("Please select transactions to send reminders for.");return}O.post(route("librarian.overdue.sendReminders"),{transaction_ids:t},{onSuccess:()=>{alert(`Reminder emails sent for ${t.length} transactions.`),i([])},onError:()=>{alert("Failed to send reminders. Please try again.")}})},w=()=>{const t=[["Student ID","Student Name","Student Email","Book ISBN","Book Title","Due Date","Days Overdue","Fine Amount"],...r.map(a=>{const x=o(a.due_date);return[a.member_id,a.student_name,a.student_email||"N/A",a.book_isbn,a.book_title,h(a.due_date),x.toString(),`$${m(x)}`]})].map(a=>a.map(x=>`"${x}"`).join(",")).join(`
`),d=new Blob([t],{type:"text/csv"}),c=window.URL.createObjectURL(d),n=document.createElement("a");n.href=c,n.download=`overdue_report_${new Date().toISOString().split("T")[0]}.csv`,n.click(),window.URL.revokeObjectURL(c)},k=r.reduce((s,t)=>{const d=o(t.due_date);return s+Number.parseFloat(m(d))},0);return console.log(r),e.jsxs(S,{breadcrumbs:B,children:[e.jsx(D,{title:"Overdue Books"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-2 text-2xl font-bold text-gray-900",children:"Overdue Books"}),e.jsx("p",{className:"text-gray-600",children:"Manage overdue books and send reminder notifications"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:w,className:"flex items-center space-x-2 rounded-lg bg-gray-600 px-4 py-2 text-white transition-colors hover:bg-gray-700",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Export Report"})]}),e.jsxs("button",{onClick:()=>u(),disabled:l.length===0,className:"flex items-center space-x-2 rounded-lg bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsxs("span",{children:["Send Reminders (",l.length,")"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:r.length})]}),e.jsx(g,{className:"h-8 w-8 text-red-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Fines"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:["$",k.toFixed(2)]})]}),e.jsx(j,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Days Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:r.length>0?Math.round(r.reduce((s,t)=>s+o(t.due_date),0)/r.length):0})]}),e.jsx(b,{className:"h-8 w-8 text-orange-600"})]})})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Overdue Transactions (",r.length,")"]}),r.length>0&&e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.length===r.length,onChange:y,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Select All"})]})]})}),r.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:r.map(s=>{const t=o(s.due_date),d=m(t);return e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:l.includes(s.id),onChange:()=>f(s.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"grid flex-1 grid-cols-1 gap-4 lg:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.student_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.member_id}),s.student_email&&e.jsx("div",{className:"text-sm text-gray-500",children:s.student_email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.book_title}),e.jsx("div",{className:"text-sm text-gray-500",children:s.book_isbn})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Due: ",h(s.due_date)]}),e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),t," days overdue"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["$",d]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Fine Amount"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>u([s.id]),className:"rounded-lg p-2 text-blue-600 transition-colors hover:bg-blue-50",title:"Send Reminder",children:e.jsx(p,{className:"h-4 w-4"})}),s.student_phone&&e.jsx("button",{onClick:()=>window.open(`tel:${s.student_phone}`),className:"rounded-lg p-2 text-green-600 transition-colors hover:bg-green-50",title:"Call Student",children:e.jsx(L,{className:"h-4 w-4"})})]})]})},s.id)})}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(g,{className:"mx-auto mb-3 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No overdue books found."}),e.jsx("p",{className:"mt-1 text-sm",children:"All books are returned on time!"})]})]})]})]})}export{J as default};
