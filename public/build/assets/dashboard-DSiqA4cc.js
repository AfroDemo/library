import{q as O,r,j as e,$ as A,m as N}from"./app-DCuZLIiR.js";import{A as M,U as F,a as v,T as w}from"./app-layout-CxSrBOU3.js";import{B as h}from"./chevron-right-MvP6eIpt.js";import{C as k}from"./calendar-B2KfnIy5.js";import{C as u}from"./clock-rXkSNBR3.js";import{D as _}from"./dollar-sign-C4xAu1P5.js";import{C as U}from"./circle-check-big-Opi59qMb.js";import{S as z}from"./search-BSJJuXeU.js";import"./app-logo-icon-l4AutvGA.js";import"./index-DWDx7uJa.js";import"./index-Bq50F9d8.js";import"./createLucideIcon-B80Gj0Dh.js";const I=[{title:"My Library",href:"/user"},{title:"Dashboard",href:"/user/dashboard"}];function ie(){const{auth:b,stats:j={},transactions:S=[],errors:V,success:H}=O().props,[i,P]=r.useState(j),[o,W]=r.useState(S),[d,Y]=r.useState(!j.myBorrowedBooks),[B,n]=r.useState([]),[C,c]=r.useState(!1),[a,D]=r.useState(null),[g,p]=r.useState(7),f=(s,t)=>{const l=Date.now().toString(),$={type:s,message:t,id:l};n(m=>[...m,$]),setTimeout(()=>{n(m=>m.filter(R=>R.id!==l))},5e3)},q=s=>{n(t=>t.filter(l=>l.id!==s))},E=s=>{!s.returned_at&&s.extension_status!=="pending"&&(D(s),p(7),c(!0))},T=()=>{a&&N.post("/transactions/extension",{transaction_id:a.id,requested_days:g},{onSuccess:()=>{c(!1),f("success","Extension request submitted successfully"),N.reload({only:["transactions","stats"]})},onError:s=>{Object.values(s).forEach(t=>f("error",t))}})},x=s=>new Date(s).toLocaleDateString(),y=s=>!s.returned_at&&new Date(s.due_date)<new Date,L=[{title:"Books Borrowed",value:i.myBorrowedBooks??0,icon:h,color:"text-blue-600"},{title:"Active Borrowed Books",value:i.activeLoans??0,icon:k,color:"text-green-600"},{title:"Overdue Books",value:i.overdueBooks??0,icon:u,color:"text-red-600"},{title:"Fines Owed",value:o.reduce((s,t)=>s+(t.fine_amount&&!t.fine_paid?t.fine_amount:0),0).toFixed(2),icon:_,color:"text-yellow-600"}];return e.jsxs(M,{breadcrumbs:I,children:[e.jsx(A,{title:"My Dashboard"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("div",{className:"rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"rounded-full bg-white/20 p-3",children:e.jsx(F,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",b.user.name,"!"]}),e.jsxs("p",{className:"text-blue-100",children:[b.user.role==="student"?"Student":"Staff"," • Library Member"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:L.map((s,t)=>e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm","aria-label":`${s.title}: ${d?"Loading":s.value}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:d?"...":s.value.toLocaleString()})]}),e.jsx(s.icon,{className:`h-8 w-8 ${s.color}`})]})},t))}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("h2",{className:"flex items-center text-lg font-semibold text-gray-900",children:[e.jsx(h,{className:"mr-2 h-5 w-5 text-blue-600"}),"Currently Borrowed Books"]})}),e.jsx("div",{className:"p-6",children:d?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading your books..."})]}):o.filter(s=>!s.returned_at).length>0?e.jsx("div",{className:"space-y-4",children:o.filter(s=>!s.returned_at).map(s=>e.jsx("div",{className:`rounded-lg border p-4 ${y(s)?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.book_title}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Borrowed: ",x(s.borrowed_at)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Due: ",x(s.due_date)]})]}),s.fine_amount&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Fine: $",s.fine_amount.toFixed(2)," ",s.fine_paid?"(Paid)":"(Unpaid)"]})]}),s.extension_status&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Extension:"," ",s.extension_status.charAt(0).toUpperCase()+s.extension_status.slice(1),s.requested_days&&` (${s.requested_days} days)`]})]})]})]}),e.jsxs("div",{className:"ml-4 space-y-2",children:[y(s)?e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(w,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Overdue"})]}):e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(U,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Active"})]}),!s.returned_at&&s.extension_status!=="pending"&&e.jsxs("button",{onClick:()=>E(s),className:"flex items-center text-blue-600 hover:text-blue-900","aria-label":`Request extension for ${s.book_title}`,children:[e.jsx(v,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Request Extension"})]})]})]})},s.id))}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(h,{className:"mx-auto mb-3 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"You don't have any books currently borrowed."}),e.jsx("p",{className:"mt-1 text-sm",children:"Visit the library to borrow some books!"})]})})]}),C&&a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold text-gray-900",children:"Request Extension"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Book"}),e.jsxs("p",{className:"text-sm text-gray-900",children:[a.book_title," (",a.book_isbn,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Current Due Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:x(a.due_date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested Extension (days)"}),e.jsx("input",{type:"number",min:"1",max:"14",value:g,onChange:s=>p(Number(s.target.value)),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500","aria-label":"Requested extension days"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"rounded-lg border border-gray-300 px-4 py-2 hover:bg-gray-50","aria-label":"Cancel",children:"Cancel"}),e.jsx("button",{onClick:T,className:"rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700","aria-label":"Submit extension request",children:"Submit Request"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("a",{href:"/user/search",className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Search Books"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Find books in the library catalog"})]})]})}),e.jsx("a",{href:"/user/history",className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(u,{className:"h-8 w-8 text-gray-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Borrowing History"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View your complete borrowing history"})]})]})})]}),e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:B.map(s=>e.jsxs("div",{className:`flex max-w-sm items-center space-x-3 rounded-lg border px-4 py-3 shadow-lg ${s.type==="success"?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:[s.type==="success"&&e.jsx("div",{className:"h-5 w-5 text-green-600",children:"✔"}),s.type==="error"&&e.jsx(w,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:s.message}),e.jsx("button",{onClick:()=>q(s.id),className:"text-gray-400 hover:text-gray-600","aria-label":"Close toast notification",children:"×"})]},s.id))})]})]})}export{ie as default};
