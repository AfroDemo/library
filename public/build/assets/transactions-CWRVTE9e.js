import{q as J,r as d,a as K,j as e,$ as Q,m as k}from"./app-DCuZLIiR.js";import{A as V,T,a as W}from"./app-layout-CxSrBOU3.js";import{D as X}from"./download-BkUYoEL1.js";import{B as N}from"./chevron-right-MvP6eIpt.js";import{C as U}from"./calendar-B2KfnIy5.js";import{C as $}from"./circle-check-big-Opi59qMb.js";import{D as O}from"./dollar-sign-C4xAu1P5.js";import{S as Y}from"./search-BSJJuXeU.js";import{C as Z}from"./clock-rXkSNBR3.js";import"./app-logo-icon-l4AutvGA.js";import"./index-DWDx7uJa.js";import"./index-Bq50F9d8.js";import"./createLucideIcon-B80Gj0Dh.js";const ee=[{title:"Admin",href:"/admin"},{title:"Transactions",href:"/admin/transactions"}];function he(){const{transactions:l={data:[],current_page:1,last_page:1,total:0,per_page:20},errors:f,success:v}=J().props,[b,D]=d.useState(l.data||[]),[i,w]=d.useState(l.data||[]),[u,y]=d.useState(l.current_page||1),[_,A]=d.useState(l.last_page||1),[R,h]=d.useState(!l.data.length),[x,L]=d.useState(""),[o,F]=d.useState("all"),[P,S]=d.useState([]),[g,q]=d.useState({total:0,active:0,returned:0,overdue:0,totalFines:0});console.log(b),d.useEffect(()=>{l.data.length?(D(l.data||[]),w(l.data||[]),y(l.current_page||1),A(l.last_page||1)):(h(!0),K.get(`/transactions?page=${u}`).then(s=>{const{data:a,current_page:r,last_page:n,total:c,per_page:t}=s.data;D(a||[]),w(a||[]),y(r||1),A(n||1),h(!1)}).catch(s=>{console.error("Failed to fetch transactions:",s),m("error","Failed to load transactions"),h(!1)})),v&&m("success",v),f&&Object.values(f).length>0&&Object.values(f).forEach(s=>m("error",s))},[l,v,f]);const m=(s,a)=>{const r=Date.now().toString();S(n=>[...n,{type:s,message:a,id:r}]),setTimeout(()=>{S(n=>n.filter(c=>c.id!==r))},5e3)},I=s=>{S(a=>a.filter(r=>r.id!==s))};d.useEffect(()=>{M(),z()},[b,x,o]);const M=()=>{let s=Array.isArray(b)?[...b]:[];x&&(s=s.filter(a=>(a.student_name||"").toLowerCase().includes(x.toLowerCase())||(a.book_title||"").toLowerCase().includes(x.toLowerCase())||(a.member_id||"").toLowerCase().includes(x.toLowerCase())||(a.book_isbn||"").toLowerCase().includes(x.toLowerCase()))),o!=="all"&&(o==="active"?s=s.filter(a=>!a.returned_at):o==="returned"?s=s.filter(a=>a.returned_at):o==="overdue"&&(s=s.filter(a=>!a.returned_at&&new Date(a.due_date)<new Date))),w(s)},z=()=>{const s=i.length,a=i.filter(t=>!t.returned_at).length,r=i.filter(t=>t.returned_at).length,n=i.filter(t=>!t.returned_at&&new Date(t.due_date)<new Date).length,c=i.reduce((t,j)=>t+(j.fine_amount&&!j.fine_paid?j.fine_amount:0),0);q({total:s,active:a,returned:r,overdue:n,totalFines:c})},B=s=>{h(!0),k.get("/transactions",{page:s,status:o==="all"?void 0:o},{preserveState:!0,onSuccess:()=>{y(s),h(!1)},onError:()=>{m("error","Failed to load page"),h(!1)}})},p=s=>new Date(s).toLocaleDateString(),C=s=>!s.returned_at&&new Date(s.due_date)<new Date,G=s=>s.returned_at?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx($,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Returned"})]}):C(s)?e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(T,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Overdue"})]}):e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx($,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Active"})]}),E=(s,a)=>{if(!s){m("error","No pending extension request found");return}k.post(`/transactions/extension/${s}/process`,{status:a},{onSuccess:()=>{m("success",`Extension request ${a}`),k.reload({only:["transactions"]})},onError:r=>{Object.values(r).forEach(n=>m("error",n))}})},H=()=>{const a=[["Transaction ID","Student ID","Student Name","Book ISBN","Book Title","Borrowed Date","Due Date","Returned Date","Status","Fine","Extension Status"],...i.map(t=>[t.id.toString(),t.member_id||"N/A",t.student_name||"Unknown User",t.book_isbn||"N/A",t.book_title||"Unknown Book",p(t.borrowed_at),p(t.due_date),t.returned_at?p(t.returned_at):"Not returned",t.returned_at?"Returned":C(t)?"Overdue":"Active",t.fine_amount?`$${t.fine_amount.toFixed(2)} ${t.fine_paid?"(Paid)":"(Unpaid)"}`:"$0.00",t.extension_status?`${t.extension_status.charAt(0).toUpperCase()+t.extension_status.slice(1)} ${t.requested_days?`(${t.requested_days} days)`:""}`:"None"])].map(t=>t.map(j=>`"${j}"`).join(",")).join(`
`),r=new Blob([a],{type:"text/csv"}),n=window.URL.createObjectURL(r),c=document.createElement("a");c.href=n,c.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,c.click(),window.URL.revokeObjectURL(n)};return e.jsxs(V,{breadcrumbs:ee,children:[e.jsx(Q,{title:"All Transactions"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("div",{className:"rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Transaction Management"}),e.jsx("p",{className:"text-blue-100",children:"Manage all library transactions and extension requests"})]}),e.jsxs("a",{href:"#",onClick:s=>{s.preventDefault(),H()},className:"flex items-center space-x-2 rounded-lg bg-white/20 px-4 py-2 text-white transition-colors hover:bg-white/30",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Export Transactions"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-5",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:g.total})]}),e.jsx(N,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Loans"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:g.active})]}),e.jsx(U,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue Books"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:g.overdue})]}),e.jsx(T,{className:"h-8 w-8 text-red-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Returned Books"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:g.returned})]}),e.jsx($,{className:"h-8 w-8 text-gray-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Fines Owed"}),e.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:["$",g.totalFines.toFixed(2)]})]}),e.jsx(O,{className:"h-8 w-8 text-yellow-600"})]})})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Search Transactions"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by student or book...",value:x,onChange:s=>L(s.target.value),className:"w-full rounded-lg border border-gray-300 py-2 pr-4 pl-10 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Filter by Status"}),e.jsxs("select",{value:o,onChange:s=>F(s.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"active",children:"Active Loans"}),e.jsx("option",{value:"returned",children:"Returned"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{L(""),F("all")},className:"w-full rounded-lg border border-gray-300 px-4 py-2 transition-colors hover:bg-gray-50",children:"Clear Filters"})})]})}),e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("h2",{className:"flex items-center text-lg font-semibold text-gray-900",children:[e.jsx(N,{className:"mr-2 h-5 w-5 text-blue-600"}),"All Transactions (",i.length,")"]})}),e.jsx("div",{className:"p-6",children:R?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading transactions..."})]}):i.length>0?e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsx("div",{className:`rounded-lg border p-4 ${C(s)?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.book_title||"Unknown Book"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ISBN: ",s.book_isbn||"N/A"]})]})]}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:"Student:"}),e.jsxs("span",{className:"ml-2",children:[s.student_name||"Unknown User"," (",s.member_id||"N/A",")"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Borrowed: ",p(s.borrowed_at)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Due: ",p(s.due_date)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Fine:"," ",s.fine_amount?`$${s.fine_amount.toFixed(2)} ${s.fine_paid?"(Paid)":"(Unpaid)"}`:"$0.00"]})]}),s.extension_status&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Extension:"," ",s.extension_status.charAt(0).toUpperCase()+s.extension_status.slice(1),s.requested_days?` (${s.requested_days} days)`:""]})]})]})]}),e.jsxs("div",{className:"ml-4 space-y-2",children:[G(s),s.extension_status==="pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>E(s.extension_id,"approved"),className:"rounded-lg bg-green-600 px-3 py-1 text-sm text-white hover:bg-green-700","aria-label":`Approve extension for transaction ${s.id}`,children:"Approve"}),e.jsx("button",{onClick:()=>E(s.extension_id,"rejected"),className:"rounded-lg bg-red-600 px-3 py-1 text-sm text-white hover:bg-red-700","aria-label":`Reject extension for transaction ${s.id}`,children:"Reject"})]})]})]})},s.id))}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(N,{className:"mx-auto mb-3 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No transactions found."})]})}),_>1&&e.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>B(u-1),disabled:u===1,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",u," of ",_]}),e.jsx("button",{onClick:()=>B(u+1),disabled:u===_,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),e.jsx("div",{className:"fixed right-4 bottom-4 z-50 space-y-2",children:P.map(s=>e.jsxs("div",{className:`flex max-w-sm items-center space-x-3 rounded-lg border px-4 py-3 shadow-lg ${s.type==="success"?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:[s.type==="success"&&e.jsx("div",{className:"h-5 w-5 text-green-600",children:"✔"}),s.type==="error"&&e.jsx(T,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:s.message}),e.jsx("button",{onClick:()=>I(s.id),className:"text-gray-400 hover:text-gray-600","aria-label":"Close toast notification",children:"×"})]},s.id))})]})]})}export{he as default};
