import{r as c,j as e,$ as C,m as S}from"./app-KiXo_k_h.js";import{A as L,U as T,T as B}from"./app-layout-BgEcNBAK.js";import{D as R}from"./download-BbFRm73X.js";import{S as A}from"./search-CQzR3Gfu.js";import{B as j}from"./chevron-right-BS6E1_9l.js";import{C as O}from"./calendar-D8t0BAEn.js";import{C as w}from"./clock-m8ZAyMD4.js";import{C as F}from"./circle-check-big-C2iU3hMD.js";import"./app-logo-icon-DguhPrG2.js";import"./index-qTwxiHtT.js";import"./index-Dz0iKmGF.js";import"./createLucideIcon-D1T_WgAe.js";const U=[{title:"Dashboard",href:"/dashboard"},{title:"Transactions",href:"/librarian/transactions"}];function W({transactions:u}){const h=u.data.map(t=>{var s,a,l;return{...t,student_name:((s=t.user)==null?void 0:s.name)||"",member_id:t.user.student.member_id?t.user.student.member_id.toString():"",book_title:((a=t.book)==null?void 0:a.title)||"",book_isbn:((l=t.book)==null?void 0:l.isbn)||""}}),[m,y]=c.useState(h),[v,E]=c.useState(!1),[i,p]=c.useState(""),[n,b]=c.useState("all"),[d,f]=c.useState("all");c.useEffect(()=>{N()},[u,i,n,d]);function N(){let t=[...h];if(i&&(t=t.filter(s=>{var a,l,o,r;return((a=s.student_name)==null?void 0:a.toLowerCase().includes(i.toLowerCase()))||((l=s.book_title)==null?void 0:l.toLowerCase().includes(i.toLowerCase()))||((o=s.member_id)==null?void 0:o.toLowerCase().includes(i.toLowerCase()))||((r=s.book_isbn)==null?void 0:r.toLowerCase().includes(i.toLowerCase()))})),n!=="all"&&(n==="active"?t=t.filter(s=>!s.returned_at):n==="returned"?t=t.filter(s=>s.returned_at):n==="overdue"&&(t=t.filter(s=>!s.returned_at&&new Date(s.due_date)<new Date))),d!=="all"){const s=new Date,a=new Date;d==="today"?(a.setHours(0,0,0,0),t=t.filter(l=>new Date(l.borrowed_at)>=a)):d==="week"?(a.setDate(s.getDate()-7),t=t.filter(l=>new Date(l.borrowed_at)>=a)):d==="month"&&(a.setMonth(s.getMonth()-1),t=t.filter(l=>new Date(l.borrowed_at)>=a))}y(t)}function x(t){return new Date(t).toLocaleDateString()}function g(t){return!t.returned_at&&new Date(t.due_date)<new Date}function _(t){return t.returned_at?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"Returned"]}):g(t)?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[e.jsx(B,{className:"mr-1 h-3 w-3"}),"Overdue"]}):e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800",children:[e.jsx(w,{className:"mr-1 h-3 w-3"}),"Active"]})}function k(){const s=[["Student ID","Student Name","Book ISBN","Book Title","Borrowed Date","Due Date","Returned Date","Status"],...m.map(r=>[r.member_id,r.student_name,r.book_isbn,r.book_title,x(r.borrowed_at),x(r.due_date),r.returned_at?x(r.returned_at):"Not returned",r.returned_at?"Returned":g(r)?"Overdue":"Active"])].map(r=>r.map(D=>`"${D}"`).join(",")).join(`
`),a=new Blob([s],{type:"text/csv"}),l=window.URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,o.click(),window.URL.revokeObjectURL(l)}return e.jsxs(L,{breadcrumbs:U,children:[e.jsx(C,{title:"Transactions"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Transaction History"}),e.jsx("p",{className:"text-gray-600",children:"View and manage all library transactions"})]}),e.jsxs("button",{onClick:k,className:"flex items-center space-x-2 rounded-lg bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Export CSV"})]})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by student, book, or ID...",value:i,onChange:t=>p(t.target.value),className:"w-full rounded-lg border border-gray-300 py-2 pr-4 pl-10 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:n,onChange:t=>b(t.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"returned",children:"Returned"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Date Range"}),e.jsxs("select",{value:d,onChange:t=>f(t.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{p(""),b("all"),f("all")},className:"w-full rounded-lg border border-gray-300 px-4 py-2 transition-colors hover:bg-gray-50",children:"Clear Filters"})})]})}),e.jsxs("div",{className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Transactions (",m.length,")"]})}),v?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading transactions..."})]}):m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Book"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Borrowed Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:m.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"mr-3 h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.student_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.member_id})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"mr-3 h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.book_title}),e.jsx("div",{className:"text-sm text-gray-500",children:t.book_isbn})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"mr-2 h-4 w-4 text-gray-400"}),x(t.borrowed_at)]})}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"mr-2 h-4 w-4 text-gray-400"}),x(t.due_date)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:_(t)}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium whitespace-nowrap",children:!t.returned_at&&e.jsx("button",{onClick:()=>S.visit(`/librarian/returns?transaction=${t.id}`),className:"text-blue-600 hover:text-blue-900",children:"Process Return"})})]},t.id))})]})}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(j,{className:"mx-auto mb-3 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No transactions found matching your criteria."})]})]})]})]})}export{W as default};
