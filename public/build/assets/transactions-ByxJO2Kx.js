import{r as d,j as e,$ as A}from"./app-KiXo_k_h.js";import{A as B,T as w,U as R}from"./app-layout-BgEcNBAK.js";import{D as O}from"./download-BbFRm73X.js";import{T as U}from"./trending-up-BRkpD7JO.js";import{C as h}from"./clock-m8ZAyMD4.js";import{C as v}from"./circle-check-big-C2iU3hMD.js";import{S as F}from"./search-CQzR3Gfu.js";import{B as y}from"./chevron-right-BS6E1_9l.js";import{C as I}from"./calendar-D8t0BAEn.js";import"./app-logo-icon-DguhPrG2.js";import"./index-qTwxiHtT.js";import"./index-Dz0iKmGF.js";import"./createLucideIcon-D1T_WgAe.js";const E=[{title:"Admin",href:"/admin"},{title:"Transactions",href:"/admin/transactions"}];function ee(){const[p,$]=d.useState([]),[i,N]=d.useState([]),[_,M]=d.useState(!0),[o,g]=d.useState(""),[c,f]=d.useState("all"),[x,j]=d.useState("all"),[u,D]=d.useState({total:0,active:0,returned:0,overdue:0});d.useEffect(()=>{k(),S()},[p,o,c,x]);const k=()=>{let t=[...p];if(o&&(t=t.filter(s=>{var a,l,n,r;return((a=s.member_name)==null?void 0:a.toLowerCase().includes(o.toLowerCase()))||((l=s.book_title)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))||((n=s.member_id)==null?void 0:n.toLowerCase().includes(o.toLowerCase()))||((r=s.book_isbn)==null?void 0:r.toLowerCase().includes(o.toLowerCase()))})),c!=="all"&&(c==="active"?t=t.filter(s=>!s.returned_at):c==="returned"?t=t.filter(s=>s.returned_at):c==="overdue"&&(t=t.filter(s=>!s.returned_at&&new Date(s.due_date)<new Date))),x!=="all"){const s=new Date,a=new Date;x==="today"?(a.setHours(0,0,0,0),t=t.filter(l=>new Date(l.borrowed_at)>=a)):x==="week"?(a.setDate(s.getDate()-7),t=t.filter(l=>new Date(l.borrowed_at)>=a)):x==="month"&&(a.setMonth(s.getMonth()-1),t=t.filter(l=>new Date(l.borrowed_at)>=a))}N(t)},S=()=>{const t=i.length,s=i.filter(n=>!n.returned_at).length,a=i.filter(n=>n.returned_at).length,l=i.filter(n=>!n.returned_at&&new Date(n.due_date)<new Date).length;D({total:t,active:s,returned:a,overdue:l})},m=t=>new Date(t).toLocaleDateString(),b=t=>!t.returned_at&&new Date(t.due_date)<new Date,C=t=>t.returned_at?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(v,{className:"mr-1 h-3 w-3"}),"Returned"]}):b(t)?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[e.jsx(w,{className:"mr-1 h-3 w-3"}),"Overdue"]}):e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800",children:[e.jsx(h,{className:"mr-1 h-3 w-3"}),"Active"]}),T=()=>{const s=[["Transaction ID","Student ID","Student Name","Book ISBN","Book Title","Borrowed Date","Due Date","Returned Date","Status"],...i.map(r=>[r.id.toString(),r.member_id,r.member_name,r.book_isbn,r.book_title,m(r.borrowed_at),m(r.due_date),r.returned_at?m(r.returned_at):"Not returned",r.returned_at?"Returned":b(r)?"Overdue":"Active"])].map(r=>r.map(L=>`"${L}"`).join(",")).join(`
`),a=new Blob([s],{type:"text/csv"}),l=window.URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`all_transactions_${new Date().toISOString().split("T")[0]}.csv`,n.click(),window.URL.revokeObjectURL(l)};return e.jsxs(B,{breadcrumbs:E,children:[e.jsx(A,{title:"All Transactions"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"mb-2 text-2xl font-bold text-gray-900",children:"Transaction Analytics"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive view of all library transactions and analytics"})]}),e.jsxs("button",{onClick:T,className:"flex items-center space-x-2 rounded-lg bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:"Export Data"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:u.total})]}),e.jsx(U,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Loans"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:u.active})]}),e.jsx(h,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Returned Books"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:u.returned})]}),e.jsx(v,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue Books"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:u.overdue})]}),e.jsx(w,{className:"h-8 w-8 text-red-600"})]})})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:o,onChange:t=>g(t.target.value),className:"w-full rounded-lg border border-gray-300 py-2 pr-4 pl-10 focus:border-blue-500 focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{value:c,onChange:t=>f(t.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"returned",children:"Returned"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Date Range"}),e.jsxs("select",{value:x,onChange:t=>j(t.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{g(""),f("all"),j("all")},className:"w-full rounded-lg border border-gray-300 px-4 py-2 transition-colors hover:bg-gray-50",children:"Clear Filters"})})]})}),e.jsxs("div",{className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["All Transactions (",i.length,")"]})}),_?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading transactions..."})]}):i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Book"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Borrowed"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:i.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-medium whitespace-nowrap text-gray-900",children:["#",t.id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"mr-3 h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.member_name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.member_id})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"mr-3 h-8 w-8 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.book_title}),e.jsx("div",{className:"text-sm text-gray-500",children:t.book_isbn})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"mr-2 h-4 w-4 text-gray-400"}),m(t.borrowed_at)]})}),e.jsx("td",{className:"px-6 py-4 text-sm whitespace-nowrap text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"mr-2 h-4 w-4 text-gray-400"}),m(t.due_date)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:C(t)})]},t.id))})]})}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(y,{className:"mx-auto mb-3 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No transactions found matching your criteria."})]})]})]})]})}export{ee as default};
